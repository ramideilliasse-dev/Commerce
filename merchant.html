 <!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Painel do Comerciante</title>

<style>
body{font-family:Arial;background:#f4f4f4;margin:0;padding:20px}
input,button{width:100%;padding:10px;margin-bottom:10px}
button{background:#111;color:white;border:none;border-radius:6px}
.section{background:white;padding:15px;border-radius:10px;margin-bottom:20px}
h3{margin-top:0}
</style>
</head>

<body>

<div class="section">
<h3>Criar Conta Comerciante</h3>

<input id="merchantName" placeholder="Nome da Loja">
<input id="merchantPhone" placeholder="Telefone WhatsApp (244...)">
<input id="merchantCity" placeholder="Cidade">

<button onclick="createMerchant()">Criar Conta</button>
</div>


<div class="section">
<h3>Adicionar Produto</h3>

<input id="productName" placeholder="Nome do Produto">
<input id="productPrice" placeholder="PreÃ§o (Kz)" type="number">
<input id="productImage" placeholder="URL da Imagem">

<button onclick="addProduct()">Publicar Produto</button>
</div>


<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, doc, getDoc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB3rKXZjJqskewJM-cBvBRw8-ecJPvoeBw",
  authDomain: "angcomerce-v1.firebaseapp.com",
  projectId: "angcomerce-v1",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
import { getAuth, onAuthStateChanged } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

const auth = getAuth(app);

onAuthStateChanged(auth, (user)=>{
  if(!user){
    window.location.href = "merchant-login.html";
  }
});
let currentMerchantId = localStorage.getItem("merchantId");


// ðŸ”µ CRÃ‰ATION COMPTE
window.createMerchant = async function(){

  const name = document.getElementById("merchantName").value;
  const phone = document.getElementById("merchantPhone").value;
  const city = document.getElementById("merchantCity").value;

  if(!name || !phone || !city){
    alert("Preencha todos os campos");
    return;
  }

  const docRef = await addDoc(collection(db,"merchants"),{
    name:name,
    phone:phone,
    city:city
  });

  localStorage.setItem("merchantId", docRef.id);
  currentMerchantId = docRef.id;

  alert("Conta criada com sucesso!");
}


// ðŸ”µ AJOUT PRODUIT
window.addProduct = async function(){

  if(!currentMerchantId){
    alert("Crie sua conta primeiro");
    return;
  }

  const name = document.getElementById("productName").value;
  const price = document.getElementById("productPrice").value;
  const image = document.getElementById("productImage").value;

  const merchantDoc = await getDoc(doc(db,"merchants",currentMerchantId));
  const merchantData = merchantDoc.data();

  await addDoc(collection(db,"products"),{
    name:name,
    price:Number(price),
    images:[image],
    merchantId:currentMerchantId,
    merchantPhone:merchantData.phone,
    merchantCity:merchantData.city,
    merchantName:merchantData.name
  });

  alert("Produto publicado com sucesso!");
}

</script>

</body>
</html>
