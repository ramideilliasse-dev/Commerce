 <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DÃ©tail Produit</title>

<style>
body{
  font-family:Arial;
  background:#f4f4f4;
  margin:0;
  padding:20px;
}

.container{
  max-width:600px;
  margin:auto;
  background:white;
  padding:20px;
  border-radius:10px;
  box-shadow:0 5px 15px rgba(0,0,0,0.1);
}

.slider{
  position:relative;
}

.slider img, .slider video{
  width:100%;
  height:300px;
  object-fit:cover;
  border-radius:10px;
}

.nav{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  background:black;
  color:white;
  border:none;
  padding:10px;
  cursor:pointer;
}

.prev{ left:10px; }
.next{ right:10px; }

.price{
  color:green;
  font-size:20px;
  font-weight:bold;
}

button{
  background:#25D366;
  border:none;
  padding:12px;
  width:100%;
  color:white;
  font-size:16px;
  border-radius:6px;
  margin-top:15px;
  cursor:pointer;
}
</style>
</head>
<body>

<div class="container">

  <div class="slider" id="mediaContainer">
    <img id="sliderImage">
    <button class="nav prev" onclick="prevMedia()">â€¹</button>
    <button class="nav next" onclick="nextMedia()">â€º</button>
  </div>

  <h2 id="productName"></h2>
  <p id="productDescription"></p>
  <div class="price" id="productPrice"></div>

  <button onclick="addToCart()">Ajouter au panier ðŸ›’</button>
  <button onclick="order()">Commander via WhatsApp</button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, doc, getDoc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyB3rKXZjJqskewJM-cBvBRw8-ecJPvoeBw",
  authDomain: "angcomerce-v1.firebaseapp.com",
  projectId: "angcomerce-v1",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const params = new URLSearchParams(window.location.search);
const productId = params.get("id");

let mediaList = [];
let currentIndex = 0;
let productData;
let merchantPhone = "";

async function loadProduct(){

  const docRef = doc(db, "products", productId);
  const docSnap = await getDoc(docRef);

  if(docSnap.exists()){

    productData = docSnap.data();

    document.getElementById("productName").innerText = productData.name;
    document.getElementById("productDescription").innerText = productData.description;
    document.getElementById("productPrice").innerText = productData.price + " Kz";

    // Images
    if(productData.images){
      productData.images.forEach(img=>{
        mediaList.push({type:"image", url:img});
      });
    }

    // Video
    if(productData.video){
      mediaList.push({type:"video", url:productData.video});
    }

    if(mediaList.length > 0){
      displayMedia(0);
    }

    // Charger tÃ©lÃ©phone commerÃ§ant
    if(productData.merchantId){
      const merchantRef = doc(db,"merchants",productData.merchantId);
      const merchantSnap = await getDoc(merchantRef);
      if(merchantSnap.exists()){
        merchantPhone = merchantSnap.data().phone;
      }
    }

  }

}

function displayMedia(index){

  const container = document.getElementById("mediaContainer");

  if(mediaList[index].type === "image"){
    container.innerHTML = `
      <img src="${mediaList[index].url}">
      <button class="nav prev" onclick="prevMedia()">â€¹</button>
      <button class="nav next" onclick="nextMedia()">â€º</button>
    `;
  }

  if(mediaList[index].type === "video"){
    container.innerHTML = `
      <video controls>
        <source src="${mediaList[index].url}">
      </video>
      <button class="nav prev" onclick="prevMedia()">â€¹</button>
      <button class="nav next" onclick="nextMedia()">â€º</button>
    `;
  }
}

window.nextMedia = function(){
  if(mediaList.length === 0) return;
  currentIndex = (currentIndex + 1) % mediaList.length;
  displayMedia(currentIndex);
}

window.prevMedia = function(){
  if(mediaList.length === 0) return;
  currentIndex = (currentIndex - 1 + mediaList.length) % mediaList.length;
  displayMedia(currentIndex);
}

window.order = function(){

  if(!merchantPhone){
    alert("NumÃ©ro WhatsApp indisponible");
    return;
  }

  const message = `Bonjour, je veux commander : ${productData.name} - ${productData.price} Kz`;
  const url = `https://wa.me/${merchantPhone}?text=${encodeURIComponent(message)}`;
  window.open(url, "_blank");
}

window.addToCart = function(){

  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  const existingProduct = cart.find(item => item.id === productId);

  if(existingProduct){
    existingProduct.quantity += 1;
  } else {
    cart.push({
      id: productId,
      name: productData.name,
      price: productData.price,
      image: productData.images ? productData.images[0] : "",
      quantity: 1
    });
  }

  localStorage.setItem("cart", JSON.stringify(cart));

  alert("Produit ajoutÃ© au panier ðŸ›’");
}

loadProduct();

</script>

</body>
</html>
