 <!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Carrinho</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial;
  background:#f4f4f4;
  padding:20px;
}

.cart-item{
  background:white;
  padding:15px;
  margin-bottom:10px;
  border-radius:10px;
}

button{
  padding:10px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-top:10px;
  width:100%;
}

.remove-btn{
  background:red;
  color:white;
}

.whatsapp-btn{
  background:#25D366;
  color:white;
}
</style>
</head>
<body>

<h2>Seu Carrinho</h2>

<div id="cartContainer"></div>

<script>

let cart = JSON.parse(localStorage.getItem("cart")) || [];

function renderCart(){

  const container = document.getElementById("cartContainer");
  container.innerHTML = "";

  if(cart.length === 0){
    container.innerHTML = "<p>Carrinho vazio</p>";
    return;
  }

  cart.forEach((item,index)=>{
    container.innerHTML += `
      <div class="cart-item">
        <strong>${item.name}</strong><br>
        ${item.price.toLocaleString()} Kz
        <button class="remove-btn" onclick="removeItem(${index})">
          Remover
        </button>
      </div>
    `;
  });

  container.innerHTML += `
    <button class="whatsapp-btn" onclick="orderByWhatsApp()">
      Finalizar pelo WhatsApp
    </button>
  `;
}

function removeItem(index){
  cart.splice(index,1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

function orderByWhatsApp(){

  if(cart.length === 0){
    alert("Carrinho vazio");
    return;
  }

  // Agrupar por vendedor
  let sellers = {};

  cart.forEach(item=>{
    if(!sellers[item.merchantPhone]){
      sellers[item.merchantPhone] = [];
    }
    sellers[item.merchantPhone].push(item);
  });

  // Enviar mensagem para cada vendedor
  for(let phone in sellers){

    let message = "Olá, quero fazer pedido:\n\n";
    let total = 0;

    sellers[phone].forEach(item=>{
      message += `• ${item.name} - ${item.price} Kz\n`;
      total += item.price;
    });

    message += `\nTotal: ${total} Kz`;

    let url = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;

    window.open(url,"_blank");
  }
}

renderCart();

</script>

</body>
</html>
